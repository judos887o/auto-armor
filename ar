local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local lp = Players.LocalPlayer

local isBuying = false

local function getPad()
    local map = Workspace:FindFirstChild("MAP")
    if map and map:FindFirstChild("Pads") then
        for _, v in ipairs(map.Pads:GetChildren()) do
            if string.find(v.Name, "Medium Armor") and v:FindFirstChild("ClickDetector") then
                return v
            end
        end
    end
    return nil
end

RunService.Heartbeat:Connect(function()
    if isBuying then return end
    
    local char = lp.Character
    if not char then return end
    
    local hum = char:FindFirstChild("Humanoid")
    if not hum or hum.Health <= 0 then return end
    
    local currentArmor = char:GetAttribute("Armor") or 0
    local maxArmor = 175
    local armorPercent = (currentArmor / maxArmor) * 100
    
    if armorPercent < 30 then
        isBuying = true
        local pad = getPad()
        if pad and pad:FindFirstChild("ClickDetector") and fireclickdetector then
            fireclickdetector(pad.ClickDetector)
        end
        task.wait(0.5)
        isBuying = false
    end
end)
