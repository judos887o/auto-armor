--// ARMOR BOT CLEAN (OHNE GUI & INTRO) //--

local UserInputService = game:GetService("UserInputService")
local player = game:GetService("Players").LocalPlayer
local isScriptActive = true

-- HIER KANNST DU DIE WERTE ANPASSEN
local HP_PROZENT_SCHWELLE        = 100      -- ab welchem HP-Prozent kaufen?
local MAXIMALE_RUSTUNG           = 175      -- Maximaler Armor-Wert
local RUSTUNGS_PROZENT_SCHWELLE  = 43       -- ab welchem Armor-Prozent kaufen?
local RUSTUNGS_SEQUENZ           = { "[High-Medium Armor]" }
local PAUSE_ZWISCHEN_KAUFEN      = 0.5      -- Sek. zwischen Clicks
local PADS_PFAD                  = game:GetService("Workspace").MAP.BuyPads

local gefundenePads = {}
local isBuying = false

if not fireclickdetector then
    warn("FEHLER: 'fireclickdetector' nicht unterstützt.")
    return
end

-- Pads initialisieren
local function initialisierePads()
    for i, name in ipairs(RUSTUNGS_SEQUENZ) do
        local pad = PADS_PFAD:FindFirstChild(name)
        if pad and pad:FindFirstChild("ClickDetector") then
            gefundenePads[i] = pad.ClickDetector
        else
            warn("FEHLER: Pad für '" .. name .. "' nicht initialisiert.")
            return false
        end
    end
    return true
end

-- komplette Kaufsequenz durchklicken
local function kaufeKompletteSequenz()
    if not isScriptActive or isBuying then return end
    isBuying = true
    print("-> KAUFBEDINGUNG ERFÜLLT! Kaufe " .. (RUSTUNGS_SEQUENZ[1] or "Armor") .. "...")

    for _, clicker in ipairs(gefundenePads) do
        if not isScriptActive then
            isBuying = false
            return
        end
        fireclickdetector(clicker)
        task.wait(PAUSE_ZWISCHEN_KAUFEN)
    end

    task.wait(1)
    isBuying = false
end

-- Überwachung von HP & Armor
local function starteUberwachung()
    task.spawn(function()
        while true do
            task.wait(0.2)

            if isScriptActive and player.Character then
                local character = player.Character
                local humanoid = character:FindFirstChildOfClass("Humanoid")

                if humanoid and humanoid.Health > 0 then
                    local aktuellerHPProzent = (humanoid.Health / humanoid.MaxHealth) * 100

                    local aktuellerRustungswert  = character:GetAttribute("Armor") or 0
                    local aktuellerRustungProzent = (aktuellerRustungswert / MAXIMALE_RUSTUNG) * 100

                    if (aktuellerHPProzent < HP_PROZENT_SCHWELLE)
                    or (aktuellerRustungProzent < RUSTUNGS_PROZENT_SCHWELLE) then
                        kaufeKompletteSequenz()
                    end
                end
            end
        end
    end)
end

-- Ein/Aus-Toggle nur über Taste G
local function toggleScriptActivity()
    isScriptActive = not isScriptActive
    if isScriptActive then
        print("### Rüstungs-Bot AKTIVIERT ###")
    else
        print("### Rüstungs-Bot DEAKTIVIERT ###")
    end
end

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.G then
        toggleScriptActivity()
    end
end)

-- Start
if initialisierePads() then
    starteUberwachung()
    print("-> Rüstungs-Bot bereit. Steuerung: Taste [G].")
else
    warn("Skript gestoppt, da Pads nicht gefunden wurden.")
end
